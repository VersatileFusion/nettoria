<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مدیریت پروفایل - نتوریا</title>
    <link rel="stylesheet" href="Assets/css/style.css">
    <link rel="stylesheet" href="Assets/css/profile.css">
</head>

<body>
    <header>
        <nav>
            <div class="logo">
                <img src="Assets/images/logo.png" alt="نتوریا">
            </div>
            <ul class="nav-links">
                <li><a href="index.html">خانه</a></li>
                <li><a href="services.html">خدمات</a></li>
                <li><a href="blog.html">وبلاگ</a></li>
                <li><a href="support.html">پشتیبانی</a></li>
            </ul>
            <div class="user-menu">
                <a href="profile.html" class="active">پروفایل</a>
                <a href="cart.html">سبد خرید</a>
                <button id="logout-btn">خروج</button>
            </div>
        </nav>
    </header>

    <main>
        <div class="profile-container">
            <div class="profile-sidebar">
                <ul class="profile-menu">
                    <li class="active" data-tab="profile">اطلاعات شخصی</li>
                    <li data-tab="security">امنیت</li>
                    <li data-tab="notifications">اعلان‌ها</li>
                </ul>
            </div>

            <div class="profile-content">
                <!-- Profile Information -->
                <section id="profile" class="profile-section active">
                    <h2>اطلاعات شخصی</h2>
                    <form id="profile-form">
                        <div class="form-group">
                            <label for="firstName">نام</label>
                            <input type="text" id="firstName" name="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="lastName">نام خانوادگی</label>
                            <input type="text" id="lastName" name="lastName" required>
                        </div>
                        <div class="form-group">
                            <label for="email">ایمیل</label>
                            <input type="email" id="email" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">شماره موبایل</label>
                            <input type="tel" id="phone" name="phone" required>
                        </div>
                        <div class="form-group">
                            <label for="company">نام شرکت (اختیاری)</label>
                            <input type="text" id="company" name="company">
                        </div>
                        <div class="form-group">
                            <label for="address">آدرس (اختیاری)</label>
                            <textarea id="address" name="address" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">ذخیره تغییرات</button>
                    </form>
                </section>

                <!-- Security Settings -->
                <section id="security" class="profile-section">
                    <h2>تنظیمات امنیتی</h2>
                    <form id="security-form">
                        <div class="security-settings">
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" name="twoFactorEnabled">
                                    احراز هویت دو مرحله‌ای
                                </label>
                                <p class="setting-description">
                                    با فعال کردن این گزینه، علاوه بر رمز عبور، کد تایید ارسال شده به موبایل یا برنامه
                                    احراز هویت نیز نیاز خواهد بود.
                                </p>
                            </div>
                        </div>

                        <div class="password-change">
                            <h3>تغییر رمز عبور</h3>
                            <form id="password-form">
                                <div class="form-group">
                                    <label for="currentPassword">رمز عبور فعلی</label>
                                    <input type="password" id="currentPassword" name="currentPassword" required>
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">رمز عبور جدید</label>
                                    <input type="password" id="newPassword" name="newPassword" required>
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">تکرار رمز عبور جدید</label>
                                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                                </div>
                                <button type="submit" class="btn btn-primary">تغییر رمز عبور</button>
                            </form>
                        </div>

                        <div class="login-history">
                            <h3>تاریخچه ورود</h3>
                            <div class="login-list">
                                <!-- Login history items will be dynamically added here -->
                            </div>
                        </div>
                    </form>
                </section>

                <!-- Notification Settings -->
                <section id="notifications" class="profile-section">
                    <h2>تنظیمات اعلان‌ها</h2>
                    <form id="notification-form">
                        <div class="notification-settings">
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" name="notify_email">
                                    اعلان‌های ایمیلی
                                </label>
                                <p class="setting-description">
                                    دریافت اعلان‌های مهم از طریق ایمیل
                                </p>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" name="notify_sms">
                                    اعلان‌های پیامکی
                                </label>
                                <p class="setting-description">
                                    دریافت اعلان‌های مهم از طریق پیامک
                                </p>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" name="notify_service">
                                    اعلان‌های سرویس
                                </label>
                                <p class="setting-description">
                                    دریافت اعلان‌های مربوط به وضعیت سرویس‌ها
                                </p>
                            </div>
                            <div class="setting-item">
                                <label>
                                    <input type="checkbox" name="notify_payment">
                                    اعلان‌های پرداخت
                                </label>
                                <p class="setting-description">
                                    دریافت اعلان‌های مربوط به تراکنش‌های مالی
                                </p>
                            </div>
                        </div>
                        <button type="submit" class="btn btn-primary">ذخیره تنظیمات</button>
                    </form>
                </section>
            </div>
        </div>

        <!-- Messages -->
        <div id="error-message" class="message error"></div>
        <div id="success-message" class="message success"></div>

        <!-- Update Profile Section -->
        <button id="updateProfileBtn">Update Profile</button>
        <script>
            document.getElementById('updateProfileBtn').onclick = async function () {
                // Collect profile fields
                const data = { /* collect from form fields */ };
                const res = await fetch('/api/users/profile', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                if (res.ok) alert('Profile updated!');
                else alert('Failed to update profile.');
            };
        </script>

        <!-- Change Password Section -->
        <button id="changePasswordBtn">Change Password</button>
        <script>
            document.getElementById('changePasswordBtn').onclick = async function () {
                const currentPassword = document.getElementById('currentPassword').value;
                const newPassword = document.getElementById('newPassword').value;
                const res = await fetch('/api/users/password', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ currentPassword, newPassword })
                });
                if (res.ok) alert('Password changed!');
                else alert('Failed to change password.');
            };
        </script>

        <script>
            // Security Settings Form
            const securityForm = document.getElementById('security-form');
            if (securityForm) {
                securityForm.onsubmit = async function (e) {
                    e.preventDefault();
                    const twoFactorEnabled = securityForm.querySelector('input[name="twoFactorEnabled"]').checked;
                    const res = await fetch('/api/users/security', {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ twoFactorEnabled })
                    });
                    if (res.ok) alert('Security settings updated!');
                    else alert('Failed to update security settings.');
                };
            }
            // Notification Settings Form
            const notificationForm = document.getElementById('notification-form');
            if (notificationForm) {
                notificationForm.onsubmit = async function (e) {
                    e.preventDefault();
                    const notify_email = notificationForm.querySelector('input[name="notify_email"]').checked;
                    const notify_sms = notificationForm.querySelector('input[name="notify_sms"]').checked;
                    const notify_service = notificationForm.querySelector('input[name="notify_service"]').checked;
                    const notify_payment = notificationForm.querySelector('input[name="notify_payment"]').checked;
                    const res = await fetch('/api/users/notifications', {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ notify_email, notify_sms, notify_service, notify_payment })
                    });
                    if (res.ok) alert('Notification settings updated!');
                    else alert('Failed to update notification settings.');
                };
            }
            // Fetch and display login history
            async function loadLoginHistory() {
                const res = await fetch('/api/users/login-history');
                if (res.ok) {
                    const data = await res.json();
                    const list = document.querySelector('.login-list');
                    if (list && data && data.history) {
                        list.innerHTML = data.history.map(item => `<div>${item.date} - ${item.ip}</div>`).join('');
                    }
                }
            }
            loadLoginHistory();
        </script>
    </main>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>درباره نتوریا</h3>
                <p>ارائه دهنده خدمات هاستینگ و سرور مجازی با بالاترین کیفیت و پشتیبانی ۲۴/۷</p>
            </div>
            <div class="footer-section">
                <h3>دسترسی سریع</h3>
                <ul>
                    <li><a href="about.html">درباره ما</a></li>
                    <li><a href="contact.html">تماس با ما</a></li>
                    <li><a href="terms.html">قوانین و مقررات</a></li>
                    <li><a href="privacy.html">حریم خصوصی</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>تماس با ما</h3>
                <p>تلفن: ۰۲۱-۱۲۳۴۵۶۷۸</p>
                <p>ایمیل: info@nettoria.com</p>
                <p>آدرس: تهران، خیابان ولیعصر</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; ۱۴۰۳ نتوریا. تمامی حقوق محفوظ است.</p>
        </div>
    </footer>

    <script src="Assets/js/utils.js"></script>
    <script src="Assets/js/api-client.js"></script>
    <script src="Assets/js/profile.js"></script>
</body>

</html>